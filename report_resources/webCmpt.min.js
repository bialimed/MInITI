/*!
  * AnaCore-web slidePanel component v1.1.1
  * Copyright 2021 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const SlidePanel=Vue.component("slide-panel",{props:{opened:{type:"boolean",default:"false"},from:{default:"right",validator:function(l){return-1!==["right","left","bottom","top"].indexOf(l)}}},template:'<div :class="[\'slider\', from + \'-slide\', {\'open\': opened}]">\n        <div class="slide-panel">\n            <button type="button" :class="[\'btn\', \'btn-secondary\', \'slide-btn-\' + from]" @click=\'$emit("close")\'>\n                <svg v-if="from === \'right\'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">\n                    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>\n                </svg>\n                <svg v-else-if="from === \'left\'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">\n                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>\n                </svg>\n                <svg v-else-if="from === \'bottom\'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">\n                    <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>\n                </svg>\n                <svg v-else-if="from === \'top\'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16">\n                    <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>\n                </svg>\n            </button>\n            <div :class="[\'slide-content-\' + from]">\n                <slot></slot>\n            </div>\n        </div>\n    </div>'});


/*!
  * AnaCore-web thresholdAlert component v1.2.0
  * Copyright 2018 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
class ThresholdAlert{constructor(e,t,s="",r=""){this.text_pre=t,this.rules=e,this.text_post=s,this.value_suffix=r}}Vue.component("threshold-alert",{props:{threshold:{required:!0,type:Object},value:{required:!0}},methods:{getThresholdCategory:function(e,t){let s=null;return Object.keys(e).sort(function(e,t){return parseFloat(e)-parseFloat(t)}).forEach(function(r){parseFloat(r)<=parseFloat(t)&&(s=e[r])}),s}},computed:{category_classes:function(){return"alert alert-"+this.getThresholdCategory(this.threshold.rules,this.value)}},template:'<div :class="category_classes" role="alert">\n            {{threshold.text_pre}} <span class="right-badge">{{value}}{{threshold.value_suffix}}</span> {{threshold.text_post}}\n        </div>'});


/*!
  * AnaCore-web msi v2.1.0
  * Copyright 2018 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
class MSILocus{constructor(t,s=null,e=null){this.position=t,this.name=s,this.results=null===e?{}:e}hasDiscordantStatus(){const t=Object.keys(this.results).map((t=>this.results[t].status));return new Set(t).size>1}mostRepresentedLen(t){const s=this.results[t].data.lengths.ct_by_len;let e=null,r=-1;for(let t in s)s[t]>=r&&(r=s[t],e=t);return e}nameOrPos(){return this.name?this.name:this.position}statusCounts(){const t={};return Object.keys(this.results).map((s=>{const e=this.results[s].status;t.hasOwnProperty(e)?t[e]+=1:t[e]=1})),t}support(t){const s=this.results[t].data.lengths.ct_by_len;return Object.values(s).reduce((function(t,s){return t+s}),0)}static fromJSON(t){const s=new MSILocus(null);return Object.keys(t).forEach((e=>{s[e]=t[e]})),s}}class MSIReport extends Array{constructor(...t){super(...t);const s=this.__proto__;Object.defineProperty(this,"__proto__",{get:()=>s,set(t){s.__proto__=t}})}getMethods(){let t=new Set;return this.forEach((s=>{s.getMethods().forEach((s=>{t.add(s)}))})),t=Array.from(t).sort(),t}existsLocusName(){let t=!1;return this.forEach((function(s){for(let e in s.loci)s.loci[e].name&&(t=!0)})),t}getLocusNameByLocusID(){let t={};return this.forEach((s=>{for(let e in s.loci){const r=s.loci[e];t[e]=r.name?r.name:e}})),t}getLoci(){let t=new Set;return this.forEach((s=>{s.getLoci().forEach((s=>{t.add(s)}))})),t=Array.from(t).sort(),t}getResByLocus(){const t=this;let s={};return t.getLoci().forEach((e=>{let r=[];t.forEach((t=>{r.push(t.loci[e])})),s[e]=r})),s}getMostRepresentedByLocus(t,s){let e={};const r=this.getResByLocus();for(let o in r){const n=r[o];let l=[];n.forEach((e=>{if(e.results.hasOwnProperty(t)){const r=e.results[t];-1!==s.indexOf(r.status)&&l.push(r.mostRepresentedLen(t))}})),e[o]=l}return e}getNbDeterminedForLocus(t,s){let e=0;return this.forEach((r=>{if(r.loci.hasOwnProperty(t)){const o=r.loci[t];o.results.hasOwnProperty(s)&&("MSI"!=o.results[s].status&&"MSS"!=o.results[s].status||(e+=1))}})),e}static fromJSON(t){const s=t.map((t=>MSISample.fromJSON(t)));return new MSIReport(...s)}}class MSISample{constructor(t,s=null,e=null){this.name=t,this.loci=null===s?{}:s,this.results=null===e?{}:e}getMajorityStatus(){let t=0,s={MSI:0,MSS:0,Undetermined:0};for(let e in this.results){t+=1;const r=this.results[e].status;s[r]+=1}const e=Object.keys(s).sort((function(t,e){return s[t]-s[e]})).reverse()[0];let r=null;return s[e]>.5*t&&(r=e),r}getLoci(){let t=new Set;for(let s in this.loci)t.add(s);return t=Array.from(t).sort(),t}getMethods(){let t=new Set;for(let s in this.results)t.add(s);return t=Array.from(t).sort(),t}getNbLoci(){return this.getLoci().length}getNbUnstable(t){const s=this;let e=0;return this.getLoci().forEach((r=>{const o=s.loci[r];o.results.hasOwnProperty(t)&&"MSI"==o.results[t].status&&(e+=1)})),e}getNbDetermined(t){const s=this;let e=0;return this.getLoci().forEach((r=>{const o=s.loci[r];o.results.hasOwnProperty(t)&&("MSI"!=o.results[t].status&&"MSS"!=o.results[t].status||(e+=1))})),e}static fromJSON(t){let s=new MSISample(null);Object.keys(t).forEach((e=>{s[e]=t[e]})),Object.keys(s.loci).forEach((t=>{s.loci[t]=MSILocus.fromJSON(s.loci[t])}));return Object.values(s.results).forEach((t=>{t.sample=s})),s}}


/*!
  * AnaCore-web dynamicTable component v1.14.0
  * Copyright 2018 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const DynamicTableHeader=Vue.component("dynamic-table-header",{props:{header:{required:!0,type:Array}},computed:{cleaned_header:function(){let e=this.header;return this.is_multi_rows||(e=new Array(e)),e},is_multi_rows:function(){return 0!==this.header.length&&Array.isArray(this.header[0])}},filters:{getRowSpan:function(e){return e.hasOwnProperty("rowspan")?e.rowspan:1},getColSpan:function(e){return e.hasOwnProperty("colspan")?e.colspan:1}},template:'<thead>\n            <tr v-for="row in cleaned_header">\n                <th v-for="col in row"\n                    :class="col.header_class"\n                    :rowspan="col | getRowSpan"\n                    :colspan="col | getColSpan"\n                    data-toggle="popover"\n                    :data-content="col.help">\n                    {{col.title}}\n                </th>\n            </tr>\n        </thead>'}),DynamicTableCell=Vue.component("dynamic-table-cell",{props:{col:{required:!0,type:Object},entry:{required:!0,type:Object}},methods:{getValue:function(e,t){return this.$options.filters.getValue(e,t)}},filters:{getValue:function(e,t){let n=null;return t.hasOwnProperty("value")?n=t.value(e):e.hasOwnProperty(t.title)&&(n=e[t.title]),t.hasOwnProperty("displayFormat")&&(n=t.displayFormat(n)),n},getHref:function(e,t){return t.href(e)},getClass:function(e,t){let n=null;return t.hasOwnProperty("class")&&(n=[t.class]),t.hasOwnProperty("entryClass")&&(added_class=t.entryClass(e),null===n?n=[added_class]:n.push(added_class)),n},getEntryInnerClass:function(e,t){let n=null;return t.hasOwnProperty("entryInnerClass")&&(n=[t.entryInnerClass(e)]),n},getSubClass:function(e,t){let n=null;return t.hasOwnProperty("subEntryClass")&&(added_class=t.subEntryClass(e),null===n?n=[added_class]:n.push(added_class)),n},getSubHref:function(e,t){return t.subEntryHref(e)},getSubSeparator:function(e){let t=" ";return e.hasOwnProperty("subEntrySeparator")&&(t=e.subEntrySeparator),t}},template:'<td :class="entry | getClass(col)">\n            <template v-if="col.is_html">\n                <span v-html="getValue(entry, col)" v-on:click="col.event ? $emit(\'click\', entry) : null"></span>\n            </template>\n            <template v-else>\n                <template v-if="col.href">\n                    <a\n                        :target="col.href_target ? col.href_target : \'_self\'"\n                        :href="entry | getHref(col)"\n                        :class="entry | getEntryInnerClass(col)">\n                        <template v-if="col.is_array">\n                            <template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n                                <span v-if="sub_idx != 0">{{col | getSubSeparator}}</span><span :class="sub_value | getSubClass(col)">{{sub_value}}</span>\n                            </template>\n                        </template>\n                        <template v-else>\n                            {{entry | getValue(col)}}\n                        </template>\n                    </a>\n                </template>\n                <template v-else>\n                    <span :class="entry | getEntryInnerClass(col)">\n                        <template v-if="col.is_array">\n                            <template v-if="col.subEntryHref">\n                                <template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n                                    <span v-if="sub_idx != 0">{{col | getSubSeparator}}</span>\n                                    <a\n                                        :target="col.href_target ? col.href_target : \'_self\'"\n                                        :href="sub_value | getSubHref(col)"\n                                        :class="sub_value | getSubClass(col)">{{sub_value}}</a>\n                                </template>\n                            </template>\n                            <template v-else>\n                                <template v-for="(sub_value, sub_idx) in getValue(entry, col)">\n                                    <span v-if="sub_idx != 0">{{col | getSubSeparator}}</span>\n                                    <span :class="sub_value | getSubClass(col)">{{sub_value}}</span>\n                                </template>\n                            </template>\n                        </template>\n                        <template v-else>\n                            {{entry | getValue(col)}}\n                        </template>\n                    </span>\n                </template>\n            </template>\n        </td>'}),DynamicTable=Vue.component("dynamic-table",{props:{cmpt_id:{type:String,default:function(){return uuid.v4()}},data:Array,export_title:{default:null,type:String},filters:{default:null,type:Object},header:{required:!0,type:Array},menu:{default:function(){return{export:!0,filter:!0,pagination:!0}},type:Object},pagination_sizes:{default:function(){return[10,25,50,100]},array:Array},scroll_x:{default:!1,type:Boolean},scroll_x_fix:{default:0,type:Number},title:String},data:function(){return{error_msg:null}},watch:{data:function(e,t){this.error_msg=null},filters:function(e,t){this.error_msg=null}},mounted:function(){if("TABLE"==$(this.$el)[0].tagName){const e=$(this.$el).DataTable(this.datatableParams);$(e.table().container()).find('[data-toggle="popover"]').popover({container:"body",trigger:"hover",html:!0});const t=this;e.on("draw",(function(n){t.$emit("change-display",e)})),this.$emit("change-display",e)}},beforeUpdate:function(){"TABLE"==$(this.$el)[0].tagName&&$(this.$el).DataTable().destroy()},updated:function(){if("TABLE"==$(this.$el)[0].tagName){const e=$(this.$el).DataTable(this.datatableParams);$(e.table().container()).find('[data-toggle="popover"]').popover({container:"body",trigger:"hover",html:!0});const t=this;e.on("draw",(function(n){t.$emit("change-display",e)})),this.$emit("change-display",e)}},computed:{is_multi_rows_header:function(){return 0!==this.header.length&&Array.isArray(this.header[0])},nb_columns:function(){let e=0,t=this.header;return this.is_multi_rows_header&&(t=this.header[0]),t.forEach((function(t){t.hasOwnProperty("colspan")?e+=t.colspan:e+=1})),e},header_mask:function(){let e=this.header;if(this.is_multi_rows_header){const t=this.header.length,n=this.nb_columns;e=new Array(t).fill([]),e.forEach((function(t,l){e[l]=new Array(n).fill(null)})),this.header.forEach((function(t,n){col_idx=0,t.forEach((function(t){for(;null!==e[n][col_idx];)col_idx+=1;colspan=t.hasOwnProperty("colspan")?t.colspan:1,rowspan=t.hasOwnProperty("rowspan")?t.rowspan:1;for(let l=n;l<n+rowspan;l++)for(let n=col_idx;n<col_idx+colspan;n++)e[l][n]=t;col_idx+=1}))}))}return e},columns:function(){let e=this.header_mask;return this.is_multi_rows_header&&(e=e[e.length-1]),e},filteredData:function(){let e=this.data;if(null!=this.filters){const t=this;try{e=e.filter((function(e){return t.filters.eval(e)}))}catch(e){this.error_msg="Error in data when apply filters."}}return e},datatableParams:function(){order_rule=[[0,"asc"]],this.columns.forEach((function(e,t){e.hasOwnProperty("sort")&&(order_rule=[[t,e.sort]])}));let e={columnDefs:[{targets:"no-sort",orderable:!1}],dom:"",lengthMenu:this.pagination_sizes,order:order_rule};return this.scroll_x&&(e.scrollX=!0,0!=this.scroll_x_fix&&(e.fixedColumns={leftColumns:this.scroll_x_fix})),this.menu.pagination&&(this.menu.filter&&(e.dom="f"),this.menu.export?e.dom="<'d-md-none'<'row'<'col-sm-12'B><'col-sm-12'l><'col-sm-12'"+e.dom+"r>>><'d-none d-md-block'<'row'<'col-md-6'<'row'<'dtable-head-btn'B>l>><'col-md-6'"+e.dom+"r>>><'row'<'col-sm-12't>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>":e.dom="<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'"+e.dom+"r>><'row'<'col-sm-12't>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>"),this.menu.export&&(null===this.export_title?e.buttons=["csv","excel"]:e.buttons=[{extend:"csv",title:this.export_title},{extend:"excel",title:this.export_title}]),e},datatableStyle:function(){let e={};return this.scroll_x&&(e={width:"100%","border-bottom":"none"}),e}},template:'<template v-if="error_msg">\n            <div class="dtable-error-msg">\n                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n                    <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>\n                </svg>\n                {{error_msg}}\n            </div>\n        </template>\n        <template v-else>\n            <table :id=cmpt_id class="table table-striped" :style="datatableStyle">\n                <caption v-if="title">\n                    {{title}}\n                </caption>\n                <dynamic-table-header :header="header"></dynamic-table-header>\n                <tbody>\n                    <tr v-for="entry in filteredData">\n                        <dynamic-table-cell v-for="(col, col_idx) in columns"\n                            v-on:click="col.event ? $emit(col.event, entry) : null"\n                            :entry="entry"\n                            :col="col"\n                        ></dynamic-table-cell>\n                    </tr>\n                </tbody>\n            </table>\n        </template>'});


/*!
  * AnaCore-web msi-locus-graph component v2.2.0
  * Copyright 2018 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
function mg_sortNumber(t,e){return t-e}function mg_ntile(t,e,n=100){const s=t.sort(mg_sortNumber);let i=null;if(0==e)i=s[0];else if(e==n)i=s[t.length-1];else{i=s[Math.ceil(e*s.length/n)-1]}return i}function mg_getMSIGraph(t,e,n,s,i=!0,r=null){let l=[],o=1/0,a=-1;t.forEach((function(t){const e=t.loci[n].results[s],r=e.data.hasOwnProperty("nb_by_length")?e.data.nb_by_length:e.data.lengths.ct_by_len,h=Object.keys(r).sort(mg_sortNumber),c=t.loci[n].results[s].status,m=!(!i&&"Undetermined"==c);o=Math.min(h[0],o),a=Math.max(h[h.length-1],a);let d=[];h.forEach((function(t){d.push([parseInt(t),r[t]])})),l.push({name:t.name,data:d,visible:m,zIndex:1})})),min_win_width=30,a-o<min_win_width&&(middle_len=(a-o)/2+o,o=Number.parseInt(middle_len-min_win_width/2-.5),a=Number.parseInt(middle_len+min_win_width/2+.5));let h=[];e&&e.hasOwnProperty(n)&&(h=[{from:mg_ntile(e[n],0),to:mg_ntile(e[n],100),label:{text:"Models most represented length"},className:"max-interval",color:2==l.length?"orange":Highcharts.getOptions().colors[l.length],id:"models_peak"}]);let c={chart:{type:"column",zoomType:"x"},xAxis:{tickInterval:1,min:o,max:a,title:{text:"Length"},plotBands:h},yAxis:{title:{text:"Nb support"}},tooltip:{crosshairs:[!0],shared:!0,formatter:function(){let t=["Nb support for <b>"+this.points[0].x+"nt</b>:"];return $.each(this.points,(function(e,n){t.push('<b><span style="color:'+n.series.color+'">'+n.series.name+"</b></span>: <b>"+n.y+"</b>")})),t.join("<br />")}},credits:{enabled:!1},series:l};return null!=r&&(c.title={text:r}),c}const MSILocusGraph=Vue.component("msi-locus-graph",{props:{report:Object,models_peaks_by_locus:Object,locus_id:String,undetermined_are_visible:{default:!0,type:Boolean},method:{required:!0,type:String},title:{type:String,default:"Microsatellite length"}},mounted:function(){this.drawGraph()},watch:{locus_id:function(t){this.drawGraph()}},computed:{graph_parameters:function(){return mg_getMSIGraph(this.report,this.models_peaks_by_locus,this.locus_id,this.method,this.undetermined_are_visible,this.title)}},methods:{drawGraph:function(){const t=this.$el,e=$(window).scrollTop();Highcharts.chart(t,this.graph_parameters),$(window).scrollTop(e)}},template:'<div class="msi-locus-graph"></div>'});


/*!
  * AnaCore-web msi-sample-table component v2.1.0
  * Copyright 2018 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
function mst_getScoreClasses(t,e){let s="danger";return e.forEach((e=>{const[a,n]=e;a<=t&&(s=n)})),["msi-label","msi-label-"+s]}function mst_getSupportClasses(t,e){let s="danger";return e.forEach((e=>{const[a,n]=e;a<=t&&(s=n)})),"na"!=s?["msi-label","msi-label-"+s]:[""]}const MSISampleTable=Vue.component("msi-sample-table",{props:{analysis:{type:Object,required:!0},class_by_score:{type:Object,default:function(){return{.7:"danger",.95:"good"}}},class_by_support_rate:{type:Object,default:function(){return{0:"danger",.66:"warning",.75:"na"}}},title:{default:"Status by method",type:String}},computed:{rows_data:function(){let t=[];return this.analysis.forEach((function(e){Object.values(e.results).forEach((function(e){t.push(e)}))})),t},header:function(){const t=this;let e=[{title:"Method",help:"Method used to determine stability status of sample.",value:function(t,e){return t.method}},{title:"Status",class:"msi-sticker",entryClass:function(t,e){return t.status},help:"Stability status prediction.",value:function(t,e){return t.status}},{title:"Score",is_html:!0,help:"Confidence score for status prediction.",value:function(e,s){let a=e.score;if(a&&"Undetermined"!=e.status){a=`<span class="${mst_getScoreClasses(a,t.scores_classes).join(" ")}">${a.toFixed(2)}</span>`}return a},sort:"desc"},{title:"Instability rate",help:"Number of unstable loci / Number of usable loci.",value:function(t,e){let s=null;return 0!=t.sample.getNbDetermined(t.method)&&(s=(t.sample.getNbUnstable(t.method)/t.sample.getNbDetermined(t.method)).toFixed(2)),s}},{title:"Support",help:"Number of usable loci.",is_html:!0,value:function(e,s){return`<span class="${mst_getSupportClasses(e.sample.getNbDetermined(e.method)/e.sample.getNbLoci(),t.supports_classes).join(" ")}">${e.sample.getNbDetermined(e.method)}</span>`}}];return this.analysis.length>1&&e.unshift({title:"Sample",value:function(t,e){return t.sample.name}}),e},scores_classes:function(){return Object.keys(this.class_by_score).sort((function(t,e){return parseFloat(t)-parseFloat(e)})).map((t=>[parseFloat(t),this.class_by_score[t]]))},supports_classes:function(){return Object.keys(this.class_by_support_rate).sort((function(t,e){return parseFloat(t)-parseFloat(e)})).map((t=>[parseFloat(t),this.class_by_support_rate[t]]))}},template:'<dynamic-table\n        :data="rows_data"\n        :header="header"\n        :title="title">\n    </dynamic-table>'});


/*!
  * AnaCore-web msi-sample-card component v2.0.0
  * Copyright 2018 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
Vue.component("msi-sample-card",{props:{analysis:{type:Object,required:!0},class_by_score:{type:Object,default:function(){return{.7:"warning",.95:"good"}}},class_by_support_rate:{type:Object,default:function(){return{.5:"warning",.7:"na"}}}},template:'<div class="row">\n        <div class="col-md-1"></div>\n        <div class="col-md-10">\n            <msi-sample-table\n                :analysis="analysis"\n                :class-by-score="class_by_score"\n                :class-by-support-rate="class_by_support_rate">\n            </msi-sample-table>\n        </div>\n    </div>'});


/*!
  * AnaCore-web msi-loci-table component v2.4.0
  * Copyright 2018 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
function mlt_getScoreClasses(t,e){let s="danger";return e.forEach((e=>{const[n,a]=e;n<=t&&(s=a)})),["msi-label","msi-label-"+s]}const MSILociTable=Vue.component("msi-loci-table",{props:{analysis:{type:Object,required:!0},class_by_score:{type:Object,default:function(){return{.7:"danger",.95:"good"}}},has_chart_lnk:{type:Boolean},reference_method:{type:String},table_title:{default:"Status by locus",type:String}},computed:{rows_data:function(){return Object.values(this.analysis.getResByLocus())},header:function(){const t=this;let e=[];0!=this.has_chart_lnk&&e.push({rowspan:2,event:"see-distrib",header_class:"no-sort",help:"Display length distribution",is_html:!0,title:"Lengths",value:function(t,e){return'<button type="button" class="btn btn-primary">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 512 512">\n                                <path d="M32 32C49.67 32 64 46.33 64 64V400C64 408.8 71.16 416 80 416H480C497.7 416 512 430.3 512 448C512 465.7 497.7 480 480 480H80C35.82 480 0 444.2 0 400V64C0 46.33 14.33 32 32 32zM160 224C177.7 224 192 238.3 192 256V320C192 337.7 177.7 352 160 352C142.3 352 128 337.7 128 320V256C128 238.3 142.3 224 160 224zM288 320C288 337.7 273.7 352 256 352C238.3 352 224 337.7 224 320V160C224 142.3 238.3 128 256 128C273.7 128 288 142.3 288 160V320zM352 192C369.7 192 384 206.3 384 224V320C384 337.7 369.7 352 352 352C334.3 352 320 337.7 320 320V224C320 206.3 334.3 192 352 192zM480 320C480 337.7 465.7 352 448 352C430.3 352 416 337.7 416 320V96C416 78.33 430.3 64 448 64C465.7 64 480 78.33 480 96V320z"/>\n                            </svg>\n                        </button>'}}),e.push({rowspan:2,help:"Locus coordinates",sort:this.analysis.existsLocusName()?null:"asc",title:"Coordinates",value:function(t,e){return t[0].position}}),this.analysis.existsLocusName()&&e.push({rowspan:2,help:"Locus name",title:"Name",sort:"asc",value:function(t,e){return t[0].name}});let s=[];return this.analysis.forEach((function(n,a){const i=n.getMethods(),o=t.reference_method?t.reference_method:i[0],r=i.length+1;e.push({colspan:r,title:n.name}),i.forEach((function(e){e==o&&s.splice(a*r,0,{title:"Support",help:"Number of reads analysed.",value:function(t,s){return t[a].support(e)}}),s.push({title:`${e} classification`,class:"msi-sticker",entryClass:function(t,s){return t[a].results[e].status},help:`Stability status and if it exists its confidence score. [predicted by ${e}]`,is_html:!0,value:function(s,n){let i=[],o=s[a].results[e].score;if(null!=o){const e=mlt_getScoreClasses(o,t.scores_classes).join(" ");i.push(`<span class="${e}">${o.toFixed(2)}</span>`)}let r=s[a].results[e].status;return"Undetermined"==r&&(r="Unknown"),i.push(r),i.join(" ")}})}))})),[e,s]},scores_classes:function(){return Object.keys(this.class_by_score).sort((function(t,e){return parseFloat(t)-parseFloat(e)})).map((t=>[parseFloat(t),this.class_by_score[t]]))}},methods:{changeLoci:function(t){const e=this.has_chart_lnk?1:0,s=t.columns(e,{search:"applied"}).data()[0].map((t=>t.replace(/<[^>]+>/g,"").replace(/\s/g,"")));this.$emit("change-loci",s)},seeDistrib:function(t){this.$emit("see-distrib",t)}},template:'<dynamic-table\n        v-on:see-distrib="seeDistrib"\n        v-on:change-display="changeLoci"\n        :data="rows_data"\n        export_title="msi_loci"\n        :header="header">\n    </dynamic-table>'});


/*!
  * AnaCore-web msi-loci-card component v3.0.0
  * Copyright 2018 CHU Toulouse
  * Author Frederic Escudie
  * Licensed under GNU General Public License
  */
const MSILociCard=Vue.component("msi-loci-card",{props:{analysis:{required:!0,type:Object},class_by_score:{default:function(){return{.7:"danger",.95:"good"}},type:Object},distrib_min_support:{default:80,type:Object},model_peaks:{type:Object},reference_method:{required:!0,type:String}},computed:{distrib_support_threshold:function(){const i={0:"danger"};return i[this.distrib_min_support]="good",new ThresholdAlert(i,"Support:")},has_multi_samples:function(){return this.analysis.length>1}},created:function(){this.distrib.loci=this.analysis.getLoci(),this.distrib.idx=0},data:function(){return{distrib:{idx:null,loci:null,opened:!1,selected:null}}},methods:{changeLoci:function(i){if(this.distrib.loci=i,this.distrib.opened){const i=this.distrib.loci.indexOf(this.distrib.selected[0].position);-1==i?this.distrib.opened=!1:this.distrib.idx=i}},prevGraph:function(){if(0!=this.distrib.idx){this.distrib.idx-=1;const i=this.distrib.loci[this.distrib.idx];this.distrib.selected=this.analysis.map((s=>s.loci[i]))}},nextGraph:function(){if(this.distrib.idx!=this.distrib.loci.length-1){this.distrib.idx+=1;const i=this.distrib.loci[this.distrib.idx];this.distrib.selected=this.analysis.map((s=>s.loci[i]))}},seeDistrib:function(i){this.distrib.selected=i,this.distrib.idx=this.distrib.loci.indexOf(i[0].position),this.distrib.opened=!0}},template:'<div class="msi-loci-card">\n        <msi-loci-table\n            @see-distrib="seeDistrib"\n            @change-loci="changeLoci"\n            :analysis="analysis"\n            :class_by_score="class_by_score"\n            :has_chart_lnk="true"\n            :reference_method="reference_method"\n            title="Status by locus">\n        </msi-loci-table>\n        <slide-panel v-if="distrib.selected"\n            from="right"\n            @close="distrib.opened = false"\n            :opened="distrib.opened">\n            <div>\n                <button\n                    @click="prevGraph"\n                    class="btn btn-primary"\n                    :disabled="distrib.idx == 0"\n                    type="button">\n                    <\n                </button>\n                <input readonly :value="distrib.selected[0].nameOrPos()">\n                <button\n                    @click="nextGraph"\n                    class="btn btn-primary"\n                    :disabled="distrib.idx == distrib.loci.length - 1"\n                    type="button">\n                    >\n                </button>\n                <span class="badge">{{(distrib.idx + 1) + \' / \' + distrib.loci.length}}</span>\n            </div>\n            <msi-locus-graph\n                :report="analysis"\n                :models_peaks_by_locus="model_peaks"\n                :locus_id="distrib.selected[0].position"\n                :method="reference_method">\n            </msi-locus-graph>\n            <div>\n                <div class="msi-graph-spl-alerts" v-for="(spl_locus, spl_idx) in distrib.selected">\n                    <span v-if="has_multi_samples">{{analysis[spl_idx].name}}</span>\n                    <div :class="{\'row\' : has_multi_samples}">\n                        <div :class="{\'col-md-6\' : has_multi_samples}">\n                            <threshold-alert\n                                :threshold="distrib_support_threshold"\n                                :value="spl_locus.support(reference_method)">\n                            </threshold-alert>\n                        </div>\n                        <div :class="{\'col-md-6\' : has_multi_samples}">\n                            <div :class="spl_locus.hasDiscordantStatus() ? \'alert alert-error\' : \'alert alert-good\'">\n                                Status consistency:\n                                <span class="status" v-for="(count, status) in spl_locus.statusCounts()">\n                                    <b>{{status}}</b>\n                                    <span class="right-badge">{{count}}</span>\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </slide-panel>\n    </div>'});
